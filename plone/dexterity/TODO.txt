Dexterity To-Do List
====================

 Immediate changes/upcoming refactoring
 --------------------------------------

    [ ] plone.dexterity: Make grokkers more like Grok
    [ ] plone.dexterity: Make custom forms easier to write

        - It should be easy to create add/edit form views by subclassing the
            existing ones and overriding some methods or setting properties
        - The plugging in of widgets from behaviors and the ordering/omission
            logic should still work
        - Should support Grok-like constructs where views in the same module
            as a content class work on that class
        - Be careful to make sure grokkers are not too magical - may want to
            rip out the auto-creation of class variables to match schema
            fields, for example
        - Prefer to do form logic with forms not interface grokkers that
            set tagged values, although for re-usable behavior schemata,
            we'll probably still need the schema UI hints
        - Grokkers should register the factory utility as a global utility
        - View grokkers should register views as global components

    [ ] plone.z3cform: Support simple add views (not registered for IAdding)
    [ ] plone.dexterity: Make add view name an FTI property
    
        - This makes add views simpler
        - Conventions should be standardised at the CMF level
        - See hints from Yuppie on the CMF list about how to simplify the 
            add() method

    [ ] plone.behavior: Add support for behaviors that either are or
            espouse marker interfaces to support "subtyping"
            
        - Prefer to keep the existing model for cases where we really just
            want an adapter to avoid depending on persistent marker interface
        - Should support markers via IObjectedCreatedEvent handler, e.g. to
            support specific browser components

    [ ] plone.supermodel: Support for interface bases
    
        - This supports a model of customisation whereby you extend another
            interface and override/amend fields. Views and adapters registered
            for the base interface will apply unless overridden.

    [ ] plone.supermodel: Support for sequence and choice fields
 

 Areas that need ownership
 -------------------------
 
    [ ] Field-level security
    
    [ ] i18n support in schema
    
    [ ] Schema editor and Plone control panel
    
    [ ] Reference engine integration
        - need field + widget
        - may need to declare support for references
    
    [ ] Versioning and staging integration
        - need CMFEditions policy for version-on-save
        - need CMFDiffTool support for IContentType
        - need iterate to use plone.app.relations instead of AT references
        
    [ ] Transforms

Detailed to-do items
====================

 plone.supermodel
 ----------------
 
    [ ] We need field handlers/syntax for:

        - Choice fields with static values
        - Choice fields using vocabulary factories
        - Dealing with the value_type of List, Tuple, Set, Frozenset fields
            - Should support simple types, by giving dotted name of type
            - Should support nested Choice fields

        This will require a new handler class, since the generic handler
        can't deal with this.

        Example syntax:
        
            <field name="pickone" type="zope.schema.Choice">
                <title>Please pick one</title>
                <vocabulary>
                    <element>Plone</element>
                    <element>Drupal</element>
                    <element>Alfresco</element>
                </vocabulary>
            </field>
            
            <field name="pickanother" type="zope.schema.Choice">
                <title>Please another one</title>
                <vocabulary>my.vocabulary.factory</vocabulary>
            </field>
            
            <field name="pickseveral" type="zope.schema.List">
                <title>Please select multiple</title>
                <value_type type="zope.schema.Choice">
                    <!-- Support full field definition here -->
                <value_type>
            </field>

 plone.dexterity
 ---------------

    Schema and FTI
    ~~~~~~~~~~~~~~
         
    [ ] Consider support for subtypes (marker interfaces), e.g. to get custom
        view components declaratively.
        
        - Allow behaviors to register optional marker interfaces
        - Use IObjectedCreatedEvent handler to apply to new instances
         
    [ ] Consider support for having one interface based on another
    
        - Use 'based-on' property on <schema /> tag (dotted name) in 
            plone.supermodel, sets bases on interface
        - Ensure bases can be synced by sync_schema
        - Also support XInclude for simple shared XML snippets?
        - In real interface, use multiple inheritance (no special support)
         
    [-] Factory and class grokker need to initialise field level security
        based on schema
        
        - There is an attempt at this in security.py, but it doesn't seem to
          make any difference. The usage is factory.py is currently commented
          out.

    [ ] Need to handle case where portal is renamed and/or FTI is renamed.
        In both cases, the prefix+portal type name encoded in the schema name 
        may cause problems. Ergo, we probably want a better way to map a named
        schema (which may not exist yet) to an actual FTI instance for looking
        up the model.
      
        - Perhaps we can keep "ghost FTI" utilities around until a new one
          is registered for the same name?
        
    Views
    ~~~~~
    
    [*] Re-evaluate how easy it is to customise the add + edit forms. 

        - May want to move to a simple add view rather than one for IAdding.
            This will require some overrides/changes to plone.app.contentmenu.
        - It should be easy to subclass and override methods to update
            widgets.
        - It should be possible to use standard z3c.form fields and groups 
            and have them extensible via ExtensibleForm.

    [*] Properly test form widget construction code
    [*] Performance test the widget construction code

    [ ] Kupu fields in add forms don't seem to save text
    [ ] Kupu attempts to load 'emptypage', but on add views it can't acquire
        this so we get a flashing 404. The fix probably needs to go into
        kupu or plone.z3cform.
    
    Misc
    ~~~~
    
    [-] Need to properly support i18n in model file
    
    [ ] Provide support for various types of migration when FTIs change, e.g.
        swapping from one FTI to another or changing a model significantly.
     
 plone.app.dexterity
 -------------------
 
    [ ] Better views for IDexterityItem and IDexterityContainer
    [ ] Provide optional standard Ploneish metadata fieldsets for add/edit 
        forms (should be implemented as a behaviour)
    [ ] Make content types support title-to-id (again, should be a behaviour)
    
    [ ] UI for managing types, importing, exporting etc.
    [ ] UI for building schemata
    [ ] UI for view customisation
        - Write out a "flat" template that includes all current fields
        - Register with portal_view_customizations
    
 Integration concerns
 --------------------
 
    - Need a reference engine, widget (plone.app.relations - fields/widgets)
    - Need versioning with version-on-save (CMFEditions policy - behavior)
    - Need content staging (iterate w/o AT references - behavior)
    - Need link integrity (linkintegrity w/o AT references - behavior)
    - Need inline validation (have this for formlib, not z3c.form)
    - Need inline editing (have this for formlib, not z3c.form)
    - Need transforms ala safe_html